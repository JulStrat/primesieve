<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="primesieve is a free software program and C/C++ library that generates primes using a highly optimized sieve of Eratosthenes implementation.">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link rel="shortcut icon" href="images/primesieve.ico" />

    <!-- Use stylesheet.css if javascript is disabled -->
    <noscript>
      <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
      <link rel="stylesheet" type="text/css" href="stylesheets/navigation_menu.css">
    </noscript>

    <!-- Use non default stylesheets if on Mac OS X -->
    <script type="text/javascript">
      function appendStylesheetToHead(name)
      {
        var osId = "";
        if (navigator.appVersion.indexOf("Mac") != -1) {
          osId = "_mac";
        }
        var el = document.createElement("link");
        el.type  = "text/css";
        el.rel   = "stylesheet";
        el.media = "screen";
        el.href  = "stylesheets/" + name + osId + ".css";
        document.getElementsByTagName("head")[0].appendChild(el);
      }

      appendStylesheetToHead("stylesheet");
      appendStylesheetToHead("navigation_menu");
    </script>

    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <script src="javascripts/jquery-1.11.0.min.js" type="text/javascript"></script> 
    <script src="javascripts/modernizr-2.7.1.min.js" type="text/javascript"></script>
    <script src="javascripts/custom.js" type="text/javascript"></script>

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>primesieve - Fast prime number generator</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>primesieve</h1>
        <h2>Fast C/C++ prime number generator</h2>
        <a href="https://github.com/kimwalisch/primesieve" class="button"><small>View project on</small>GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

<div id="nav_div">
  <nav id="navigation">
    <ul id="nav_ul">
      <li><a href=".">Home</a></li>
      <li><a href="downloads">Downloads</a></li>
      <li><a href="https://github.com/kimwalisch/primesieve#build-requirements">Build From Source</a></li>
      <li><a href="segmented_sieve.html">Segmented Sieve</a></li>
      <li><a href="api">API Documentation</a></li>
      <li><a href="links.html">Links</a></li>
    </ul>
  </nav>
</div>

<h2 class="align2">
<a name="about" class="anchor" href="#about"><span class="octicon octicon-link"></span></a>About</h2>
<p>primesieve is a free software program and C/C++ library that
generates primes using a
<a href="#implementation">highly optimized sieve of Eratosthenes
implementation</a>. It counts the primes below 10^10 in just 0.45
seconds on an Intel Core i7-6700 CPU (4&nbsp;x&nbsp;3.4GHz).
primesieve can generate primes and
<a href="http://en.wikipedia.org/wiki/Prime_k-tuple">prime k-tuplets</a>
up to 2^64.</p>

<a href="screenshots/primesieve_large.png" alt="Large screenshot">
<img src="screenshots/primesieve_osx_macpro.png" alt="primesieve Mac OS X application" style="padding-top: 15px;  padding-bottom: 10px;"/>
</a>

<h2>
<a name="speed" class="anchor" href="#speed"><span class="octicon octicon-link"></span></a>Speed comparison</h2>
<p>primesieve generates primes about 50 times faster (single-threaded)
than an ordinary C/C++ sieve of Eratosthenes implementation and about
10,000 times faster than trial-division. primesieve outperforms the
author's older
<a href="http://primzahlen.de/referenten/Kim_Walisch/index2.htm">ecprime</a>
(fastest open source prime number generator from 2002 to 2010) by about
30 percent and also substantially outperforms
<a href="http://cr.yp.to/primegen.html">primegen</a> the fastest sieve
of Atkin implementation on the web. Here is a
<a href="links.html#implementations">historical list</a> of fast prime
sieve implementations</a>.
</p>

<div id="timings">
<h2 style="padding-bottom: 8px">
<a name="timings" class="anchor" href="#timings"><span class="octicon octicon-link"></span></a>Timings</h2>
<table style="width: 750px;">
<tr>
    <td class="timing_title">x</td>
    <td class="timing_title">
      <span style="white-space: nowrap;">Prime Count</span>
    </td>
    <td class="timing_title">
      <span style="white-space: nowrap;">AMD Phenom II X4 945</span><br/>
      <span class="cpu_details">(4 x 3.0GHz, 64K L1 Data Cache)</span>
    </td>
    <td class="timing_title">
      <span style="white-space: nowrap;">Intel Core i7-6700</span><br/>
      <span class="cpu_details">(4 x 3.4GHz, 32K L1 Data Cache)</span>
    </td>
    <td class="timing_title">
      <span style="white-space: nowrap;">IBM POWER8</span><br/>
      <span class="cpu_details">(22 x 3.0GHz, 64K L1 Data Cache)</span>
    </td>
</tr>
<tr style="background-color: white">
    <td class="timing">10<sup>8</sup></td>
    <td class="timing">5,761,455</td>
    <td class="timing">0.01s</td>
    <td class="timing">0.01s</td>
    <td class="timing">0.01s</td>
</tr>
<tr>
    <td class="timing">10<sup>9</sup></td>
    <td class="timing">50,847,534</td>
    <td class="timing">0.06s</td>
    <td class="timing">0.05s</td>
    <td class="timing">0.07s</td>
</tr>
<tr style="background-color: white">
    <td class="timing">2<sup>32</sup></td>
    <td class="timing">203,280,221</td>
    <td class="timing">0.34s</td>
    <td class="timing">0.19s</td>
    <td class="timing">0.15s</td>
  </tr>
<tr>
<td class="timing">10<sup>10</sup></td>
    <td class="timing">455,052,511</td>
    <td class="timing">0.66s</td>
    <td class="timing">0.45s</td>
    <td class="timing">0.24s</td>
</tr>
<tr style="background-color: white">
    <td class="timing">10<sup>11</sup></td>
    <td class="timing">4,118,054,813</td>
    <td class="timing">8.57s</td>
    <td class="timing">5.60s</td>
    <td class="timing">1.72s</td>
</tr>
<tr>
    <td class="timing">10<sup>12</sup></td>
    <td class="timing">37,607,912,018</td>
    <td class="timing">122.02s</td>
    <td class="timing">68.55s</td>
    <td class="timing">19.34s</td>
</tr>
<tr style="background-color: white">
    <td class="timing">10<sup>13</sup></td>
    <td class="timing">346,065,536,839</td>
    <td class="timing">1664.68s</td>
    <td class="timing">816.62s</td>
    <td class="timing">225.92s</td>
</tr>
</table>

<p><br/>The above benchmarks were run on Linux, for each
benchmark primesieve used all available CPU cores and the sieve
size was set to the CPU's L1 data cache size.</p>
</div>

<h2 style="padding-bottom: 5px">
<a name="cpu-scaling" class="anchor" href="#cpu-scaling"><span class="octicon octicon-link"></span></a>CPU scaling</h2>
<img src="images/primesieve_cpu_scaling.png" alt="primesieve CPU scaling"/>
<p style="padding-top: 13px">primesieve scales linearly up to a very
large number of CPU cores (if the interval is sufficiently large). The
above benchmark was run on a system with 8 physical CPU cores, at each
start offset the primes inside an interval of size 10^11 were counted
using different numbers of threads.</p>

<h2 class="align2">
<a name="algorithms" class="anchor" href="#algorithms"><span class="octicon octicon-link"></span></a>Algorithms</h2>
<p>primesieve generates primes using the segmented
<a href="http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes">sieve of
Eratosthenes</a> with
<a href="http://en.wikipedia.org/wiki/Wheel_factorization">wheel
factorization</a>, this algorithm has a complexity of
<img src="images/Onloglogn.svg" alt="O(n log log n)" class="formula"/>
operations and uses
<img src="images/Osqrtn.svg" alt="O(sqrt(n))" class="formula"/>
space.</p>

<p>Segmentation is currently the best known practical improvement to
the sieve of Eratosthenes. Instead of sieving the interval
[2, n] at once one subdivides the sieve interval into a
number of equal sized segments that are then sieved consecutively.
Segmentation drops the memory requirement of the sieve of Eratosthenes from
<img src="images/On.svg" alt="O(n)" class="formula"/> to
<img src="images/Osqrtn.svg" alt="O(sqrt(n))" class="formula"/>.
The segment size is usually chosen to fit into the CPU's fast L1 or L2
cache memory which significantly speeds up sieving. A segmented
version of the sieve of Eratosthenes was first published by Singleton
in 1969 [1]. Here is a <a href="segmented_sieve.html">simple implementation
of the segmented sieve of Eratosthenes</a>.</p>

<p>Wheel factorization is used to skip multiples of small primes. If a
<i>k</i>th wheel is added to the sieve of Eratosthenes then only those
multiples are crossed off that are coprime to the first <i>k</i>
primes, i.e. multiples that are divisible by any of the first <i>k</i>
primes are skipped. The 1st wheel considers only odd numbers, the 2nd
wheel (modulo 6) skips multiples of 2 and 3, the 3rd wheel (modulo 30)
skips multiples of 2, 3, 5 and so on. Pritchard has shown in [2] that
the running time of the sieve of Eratosthenes can be reduced by a factor of
<img src="images/loglogn.svg" alt="log log n" class="formula"/>
if the wheel size is
<img src="images/propsqrtn.svg" alt="sqrt(n)" class="formula"/>
but for cache reasons the sieve of Eratosthenes usually performs best
with a modulo 30 or 210 wheel. Sorenson explains wheels in [3].</p>

<p>Additionally primesieve uses Tomás Oliveira e Silva's
<a href="http://www.ieeta.pt/~tos/software/prime_sieve.html">cache-friendly bucket list algorithm</a>
if needed [4]. This algorithm is relatively new, it has
been devised by Tomás Oliveira e Silva in 2001 in order to speed up
the segmented sieve of Eratosthenes for prime numbers past 32 bits.
The idea is to store the sieving primes into lists of buckets with
each list being associated with a segment. A list of sieving primes
related to a specific segment contains only those primes that have
multiple occurrence(s) in that segment. Whilst sieving a segment only
the primes of the related list are used for sieving and each prime is
reassigned to the list responsible for its next multiple when
processed. The benefit of this approach is that it is now possible to
use segments (i.e. sieve arrays) smaller than
<img src="images/sqrtn.svg" alt="sqrt(n)" class="formula"/>
without deteriorating efficiency, this is important as only small
segments that fit into the CPU's L1 or L2 cache provide fast memory
access.</p>

<h2>
<a name="implementation" class="anchor" href="#implementation"><span class="octicon octicon-link"></span></a>Implementation</h2>
<p>primesieve is written entirely in C++ and does not depend on
external libraries. It's speed is mainly due to the segmentation of
the sieve of Eratosthenes which prevents cache misses when crossing
off multiples in the sieve array and the use of a bit array instead of
a boolean sieve array. primesieve reuses and improves ideas from other
great sieve of Eratosthenes implementations, namely Achim
Flammenkamp's
<a href="http://wwwhomes.uni-bielefeld.de/achim/prime_sieve.html">prime_sieve.c</a>,
Tomás Oliveira e Silva's
<a href="http://sweet.ua.pt/tos/software/prime_sieve.html#s">A1 implementation</a>
and the author's older
<a href="http://primzahlen.de/referenten/Kim_Walisch/index2.htm">ecprime</a>
all written in the late '90s and '00s. Furthermore primesieve contains
new optimizations to increase
<a href="http://en.wikipedia.org/wiki/Superscalar">instruction-level parallelism</a>
and more efficiently uses the larger number of registers in today's
CPUs.</p>
<p class="optimizations_title">Optimizations used in primesieve</p>
<ul>
  <li>Uses a bit array with 8 flags each 30 numbers for sieving</li>
  <li>Pre-sieves multiples of small primes ≤ 19</li>
  <li>Compresses the sieving primes in order to improve cache efficiency [5]</li>
  <li>Starts crossing off multiples at the square</li>
  <li>Uses a modolo 210 wheel that skips multiples of 2, 3, 5 and 7</li>
  <li>Uses specialized algorithms for small, medium and big sieving primes</li>
  <li>Uses a custom memory pool (for big sieving primes)</li>
  <li>Processes multiple sieving primes per loop iteration to increase instruction-level parallelism</li>
  <li>Parallelized (multi-threaded) using <a href="http://openmp.org/">OpenMP</a></li>
</ul>

<div id="inner_loop">
<p class="optimizations_title">Highly optimized inner loop</p>
<p>primesieve's inner sieving loop has been optimized using
<a href="https://github.com/kimwalisch/primesieve/blob/master/src/primesieve/EratSmall.cpp#L85">extreme loop unrolling</a>,
on average crossing off a multiple uses just 1.375 instructions on
x64 CPUs. Below is the assembly GCC generates for primesieve's inner
sieving loop, each <code>andb</code> instruction unsets a bit (crosses
off a multiple) in the sieve array.</p>
<script src="https://gist.github.com/kimwalisch/df939440b89081c39f6a.js"></script>
</div>

<p>This <a href="https://github.com/kimwalisch/primesieve/blob/master/src/primesieve/README">README</a>
file contains more technical implementation details.</p>

<h2>
<a name="cpp-library" class="anchor" href="#cpp-library"><span class="octicon octicon-link"></span></a>C/C++ library</h2>

<div id="libprimesieve_script">
<p>Below is a C++ example with the most common libprimesieve use cases.</p>
<script src="https://gist.github.com/kimwalisch/afd69bf11daf59795c64.js"></script>
</div>

<p>libprimesieve natively supports C and C++, there are many
<a href="https://github.com/kimwalisch/primesieve/tree/master/examples">
C and C++ examples on GitHub</a>.</p>

<ul>
  <li><a href="https://github.com/kimwalisch/primesieve#build-requirements">How to install libprimesieve</a></li>
  <li><a href="api">Browse primesieve's API online</a></li>
</ul>


<h2>
<a name="bindings" class="anchor" href="#bindings"><span class="octicon octicon-link"></span></a>Bindings for other languages</h2>
<p>primesieve natively supports C and C++ and has bindings available for a few other programming languages:</p>

<table style="width: 1px;">
    <tr>
        <td class="binding_language">Python:</td>
        <td class="binding_link"><a href="https://github.com/hickford/primesieve-python">primesieve-python</a></td>
      </tr>
    <tr style="background-color: white">
        <td class="binding_language">Ruby:</td>
        <td class="binding_link"><a href="https://github.com/robertjlooby/primesieve-ruby">primesieve-ruby</a></td>
    </tr>
</table>

<p class="binding">Many thanks to the developers of these bindings!</p>

<div id="references">
<h2>
<a name="references" class="anchor" href="#references"><span class="octicon octicon-link"></span></a>References and notes</h2>
<ol>
  <li>R. C. Singleton, "An efficient prime number generator", Communications of the ACM 12, 563-564, 1969.</li>
  <li>Paul Pritchard, "Fast compact prime number sieves (among others)", Journal of Algorithms 4 (1983), 332-344.</li>
  <li>Jonathan Sorenson, <a href="ftp://ftp.cs.wisc.edu/pub/techreports/1991/TR1028.pdf">"An analysis of two prime number sieves"</a>, Computer Science Technical Report Vol. 1028, 1991.</li>
  <li>Tomás Oliveira e Silva, <a href="http://www.ieeta.pt/~tos/software/prime_sieve.html">"Fast implementation of the segmented sieve of Eratosthenes"</a>, 2002.</li>
  <li>Actually not the sieving primes are compressed but their sieve and wheel indexes.</li>
</ol>
</div>

        </section>

        <aside id="sidebar">
          <a href="https://github.com/kimwalisch/primesieve/zipball/master" class="download_button button">
            <small>Download</small>
            <span>.zip file</span>
          </a>

          <iframe src="http://ghbtns.com/github-btn.html?user=kimwalisch&repo=primesieve&type=watch&count=true&size=large" height="30" width="170" frameborder="0" scrolling="0" style="width:170px; height: 30px;" allowTransparency="true"></iframe>
          <p class="repo-owner" style="padding-top: 14px;"><a href="https://github.com/kimwalisch/primesieve"></a> is maintained by <a href="https://github.com/kimwalisch">kimwalisch</a>.</p>

          <p>This page was published with <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

    <!-- Mac OS X:   include larger_github_gist_font_size_mac.css -->
    <!-- Other OSes: include larger_github_gist_font_size.css -->
    <script type="text/javascript">
      var osId = "";

      if (navigator.appVersion.indexOf("Mac") != -1) {
        osId = "_mac";
      }

      var el = document.createElement("link");
      el.type  = "text/css";
      el.rel   = "stylesheet";
      el.media = "screen";
      el.href  = "stylesheets/" + "larger_github_gist_font_size" + osId + ".css";

      document.getElementsByTagName("body")[0].appendChild(el);
    </script>

  </body>
</html>
