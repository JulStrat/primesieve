# Test configuration for Travis CI. See <https://travis-ci.org/>.
language: generic
os: linux

branches:
  except:
    - gh-pages

# This is a workaround which installs recent GCC and Clang
# compilers that support C++11
matrix:
  include:
    - os: linux
      env: COMPILER_NAME=gcc CXX=g++-5 CC=gcc-5
      addons:
        apt:
          packages:
            - g++-5
          sources: &sources
            - llvm-toolchain-precise-3.8
            - ubuntu-toolchain-r-test
    - os: linux
      env: COMPILER_NAME=clang CXX=clang++-3.8 CC=clang-3.8
      addons:
        apt:
          packages:
            - clang-3.8
          sources: *sources

env:
  global:
    - OMP_NUM_THREADS=4

install:
  - sudo apt-get install -y ninja-build cppcheck doxygen help2man texlive graphviz libqt4-dev qt4-qmake
  - wget --no-check-certificate http://cmake.org/files/v3.1/cmake-3.1.3-Linux-x86_64.tar.gz
  - tar -xzf cmake-3.1.3-Linux-x86_64.tar.gz
  - export CXXFLAGS="-Wall -Wextra -Werror -Wno-long-long -pedantic -O2"
  - export PATH=$PWD/cmake-3.1.3-Linux-x86_64/bin:$PATH

script:
  # Test using GNU make
  - mkdir build
  - cd build
  - cmake -DBUILD_EXAMPLES=ON -DBUILD_TESTS=ON ..
  - make -j4
  - make doc
  - cd ..
  - rm -rf build
  # Test using ninja (build system)
  - mkdir build
  - cd build
  - cmake -GNinja -DBUILD_EXAMPLES=ON -DBUILD_TESTS=ON ..
  - ninja
  - ninja doc
  - ninja test
  - cd ..
  - rm -rf build
  # Test using cppcheck (static code analysis)
  - cppcheck . --error-exitcode=1 -iexamples/cpp/prev_prime.cpp -iexamples/cpp/primesieve_iterator.cpp
  # Build primesieve GUI app
  - cd src/gui
  - qmake QMAKE_CXX="$CXX" QMAKE_CC="$CC"
  - make -j4
